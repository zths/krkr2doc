<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from EventSystem.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>事件システム</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关リファレンス用標準スタイル" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="主页" />
</head>
<body>
<h1><a id="id96" name="id96">事件システムについて</a>
</h1><div class="para"><div>
　吉里吉里で TJS 脚本を記述する場合、事件駆動型のプログラミングモデルを採る必要があります。<br />
　事件は「何かが起こった」ときに、他の对象や、自分の对象内にそれを通知するために発生します。事件ハンドラにはこれに応答する処理を書くことになります。<br />
　吉里吉里では一つの事件ハンドラで必要以上に長い時間がかかることは好ましくありません。時間を待ちたいときは <a target="main" class="jump" href="f_Timer.html">Timer</a> 类を用いることをおすすめします。<br />
</div></div>
<h1><a id="id97" name="id97">同期事件と非同期事件</a>
</h1><div class="para"><div>
　同期事件とは、たとえば声音バッファで再生を开始した場合に、その play 方法内で onStatusChanged 事件が発生するように、对象の操作を行うとすぐにその場で発生する事件です。<br />
　これに対し、非同期事件とは、吉里吉里内部にある事件キュー ( 発生させる事件を一時保管している場所 ) に一時的に蓄積されます。この事件はすべての他の事件ハンドラの処理が終わるまで発生せず、他の事件ハンドラ内では発生しません(ただし异常があるので下記 note を参考してください)。タイマー周期が来て発生する onTimer 事件などや、ユーザからの入力により発生するすべての事件は非同期事件です。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　Window.showModal のような一部の、ユーザからの入力を得ようとするような功能は、事件キューを動作させる (事件を配信する) ことがあります。これにより、事件ハンドラ中で別の非同期事件が発生する可能性はあります。</div><br />
　非同期事件を脚本の操作で発生させるために <a target="main" class="jump" href="f_AsyncTrigger.html">AsyncTrigger</a> 类があります。<br />
</div></div>
<h1><a id="id98" name="id98">画面反映のタイミング</a>
</h1><div class="para"><div>
　窗口に图层を显示するための画面反映のタイミングは非同期事件と同じで、すべての他の事件ハンドラの処理が行われたあとです。一つの事件ハンドラ内で何度描画を行っても、内部的な画像バッファには描画されていますが、画面にはすぐに反映はされません。事件ハンドラからぬけて、吉里吉里が描画のタイミングを得たときに初めて窗口に内容が描画され、反映されます。<br />
</div></div>
<h1><a id="id99" name="id99">类内での事件ハンドラ</a>
</h1><div class="para"><div>
　类内で発生した事件はその类内で、スーパー类の事件ハンドラをオーバーライドすることによりハンドリングする事ができます。<br />
　たとえば、Timer 类からサブ类を作成し、以下のように事件ハンドラを作成することができます。<br />

<br />
<code class="bq">class&nbsp;MyTimer&nbsp;extends&nbsp;Timer<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;MyTimer()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.Timer(...);<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;onTimer()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;(&nbsp;ここに&nbsp;onTimer&nbsp;の処理&nbsp;)</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.onTimer(...);&nbsp;<span class="comment">//&nbsp;スーパー类の方法は一応呼び出す</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
}<br />
</code>
<br />

　スーパー类の方法は呼び出す必要はありませんが、一般的には呼び出します。また、スーパー类の方法は呼ばないと後述の action 方法による事件ハンドリングができません。<br />
</div></div>
<h1><a id="id100" name="id100">action方法</a>
</h1><div class="para"><div>
　<a target="main" class="jump" href="f_Layer.html">Layer</a> 类や <a target="main" class="jump" href="f_WaveSoundBuffer.html">WaveSoundBuffer</a> 类などは、构造函数に指定したオーナーの action 方法に事件を発生する功能があります。<br />
　action 方法には字典数组对象の引数が一つ渡され、ここに事件の信息が入っています。<br />
　字典数组のメンバのうち、 target は事件の発生元对象を表しています。type は事件名を表しています。<br />
　その他のメンバは事件によって異なります。たとえば、<a target="main" class="jump" href="f_Layer_onClick.html">Layer.onClick</a> 事件ならば、x と y というメンバがあり、图层上をクリックされた場所を表します。<br />

<br />
<code class="bq">例子:<br />
class&nbsp;MyWindow&nbsp;extends&nbsp;Window<br />
{<br />
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;layer;<br />
&nbsp;&nbsp;&nbsp;&nbsp;(略)<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;MyWindow()<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.Window(...);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add(layer&nbsp;=&nbsp;new&nbsp;Layer(this&nbsp;<span class="comment">/*&nbsp;this&nbsp;=&nbsp;オーナー&nbsp;*/</span>,&nbsp;null));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;layer.visible&nbsp;=&nbsp;true;<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;(略)<br />
&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;action(ev)<br />
&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(ev.type&nbsp;==&nbsp;&quot;onClick&quot;&nbsp;&amp;&amp;&nbsp;ev.target&nbsp;==&nbsp;layer)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">//&nbsp;layer&nbsp;がクリックされた</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.inform(ev.x,&nbsp;ev.y);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;}<br />
}<br />
</code>
<br />

</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
