<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from Debug.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>调试</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关リファレンス用標準スタイル" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="主页" />
</head>
<body>
<h1><a id="id93" name="id93">アプリケーションの调试について</a>
</h1><div class="para"><div>
　调试とは、アプリケーション内にあるバグ(功能不全や想定しない動作の原因)を特定し、修正する作業です。<br />
　吉里吉里はいくつかの调试支援功能を持っていますので、その功能を用い、アプリケーションを调试します。その方法について说明します。</div></div>
<h1><a id="id94" name="id94">调试支援窗口</a>
</h1><div class="para"><div>
吉里吉里は调试を支援するための窗口をいくつか提供しています。詳しくは各リンクの说明を参考してください。<br />
<dl>
<dt><a target="main" class="jump" href="Controller.html">控制器</a></dt>
<dd>各调试支援窗口を開いたり、事件発生の停止や TJS コンテキストのダンプ、メッセージマップ文件の作成、システムの強制结束をすることができます。</dd>
<dt><a target="main" class="jump" href="ScriptEditor.html">脚本エディタ</a></dt>
<dd>簡単な TJS 脚本の编辑とその执行をすることができます。また、异常が発生したとき、その异常の発生位置を指し示すために「脚本エディタ (异常通知)」という脚本エディタの窗口が開く場合があります。</dd>
<dt><a target="main" class="jump" href="ExprWatch.html">監視式</a></dt>
<dd>多くの式の結果を一度に确认することができます。</dd>
<dt><a target="main" class="jump" href="Console.html">控制台</a></dt>
<dd>吉里吉里のシステムや、ユーザ脚本が出力する様々な调试用メッセージを显示することができます。また、TJS2 式を入力してその場で执行し、式の結果を显示させる事もできます。</dd></dl><br />
　特に控制台では、<a target="main" class="jump" href="f_Debug_message.html">Debug.message</a> によってユーザプログラムがプログラム中で出力したメッセージが显示されます。プログラムの任意の場所で方法を呼び出し、変数の内容を控制台に显示させ、执行中の変数の内容を見ることができます。<br />
　また、控制台の下部の入力欄にTJS2式を入力し、Enterキーを押すことでその式をその場で执行することができます。これは、执行中の对象の方法を直接呼び出したり、对象の属性や変数に値を代入する際に便利です。<br />
　控制台へメッセージを显示する方法やログを文件に記述する方法については、<a target="main" class="jump" href="CommandLine.html">コマンドラインオプション</a> の 「调试相关のオプション」や <a target="main" class="jump" href="f_Debug.html">Debug 类</a> を参考してください。<br />
</div></div>

<h1><a id="id95" name="id95">调试モード</a>
</h1><div class="para"><div>
　<a target="main" class="jump" href="CommandLine.html">コマンドラインオプション</a> で '-debug' を指定する (「调试モード」を'有効'にする) と、吉里吉里を调试モードで動作させることができます。<br />
　调试モードではTJS2の動作は低速になりますが、调试に便利ないくつかの功能が有効になります。<br />
<br />
<dl>
<dt>型信息追跡功能</dt>
<dd>　TJS2の对象に関する信息が強化されます。<br />
　调试モードではない場合は、たとえば KAG で kag.saveSystemVariables の信息を得ようとして控制台に <code class="inlinecode">kag.saveSystemVariables</code> と入力しても
<br />
<code class="bq">控制台&nbsp;:&nbsp;kag.saveSystemVariables&nbsp;=&nbsp;(object)(object&nbsp;0x0279E130:0x01EB0BD4)</code>
<br />

　と显示されるだけですが、调试モードが有効の場合は
<br />
<code class="bq">控制台&nbsp;:&nbsp;kag.saveSystemVariables&nbsp;=&nbsp;(object)(object&nbsp;0x0279E130[(function)&nbsp;KAGWindow.saveSystemVariables]:0x01EB0BD4[instance&nbsp;of&nbsp;class&nbsp;KAGWindow])</code>
<br />

　のように型の信息が显示されます (':' で区切られた２つの部分のうち、前の部分は对象の型、後ろの部分はその对象が動作するコンテキストです )。<br />
　この功能は、控制台で値を显示させる場合にとどまらず、(現版本では)对象が字符串に変換される過程すべてで有効になります。<br />
</dd>
<dt>对象リーク検出功能</dt>
<dd>　删除されていない(解放されていない)对象を结束時に警告する功能が有効になります。<br />
　TJS2は本来、ガベージコレクション功能により、作成された对象は自動的に删除され、明示的な删除の指示は必要ありません。しかし、插件や吉里吉里本体のバグ、循環参考が原因で、对象が删除されないままになる(リークする)可能性があります。<br />
　调试モードでは、结束時になってもまだ解放されていない对象が控制台のログ文件に書き出されます。<br />
　たった一個の对象が解放されなかっただけでも、その对象に相关する对象が全て検出されるため、ログ文件が巨大になる可能性がありますので注意してください。<br />
<br />
　<a target="main" class="jump" href="f_System_exit.html">System.exit</a> 方法は、アプリケーションを強制结束に近い形で结束させるもので、この方法でアプリケーションを结束させると多くの对象がリークし、大量のログが記録されますので注意してください。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
循環参考とは、A は B を参考している、B は A を参考しているという状況の事です。<br />
たとえば、以下の脚本は循環参考を生成します。
<br />
<code class="bq">var&nbsp;a&nbsp;=&nbsp;%[],&nbsp;b&nbsp;=&nbsp;%[];<br />
a.b&nbsp;=&nbsp;b;&nbsp;b.a&nbsp;=&nbsp;a;</code>
<br />

このような状況では、对象 a は b を必要とし、对象 b は a を必要としています。TJS2が採用しているガベージコレクションの方法(参考カウンタ)はこのような状況を検出して对象を解放するのは困難であるため、TJS2ではこのような状況を検出しません。そのため、いつまで経ってもこれらの对象が删除されることはありません (明示的に invalidate 演算子でどちらかの对象を無効化すると循環参考を断ち切ることができます)。<br />
<br />
插件では、参考カウンタの扱いを誤ると对象がリークする可能性があります。插件を作成して、その中でTJS2对象を扱う場合は、参考カウンタの扱いに十分注意してください。<br />
</div><br />
</dd>
<dt>删除中の对象での脚本执行の警告</dt>
<dd>　对象は、删除あるいは無効化されるときに finalize 方法が呼ばれます。<br />
　对象が删除されるタイミングは、TJS2では「いつになるかわからない」ため、変なタイミングで finalize 方法がよばれ、予期しない挙動を示す場合があります。调试モードでは、このような「不安定なタイミング」、つまり無効化されなかった对象がガベージコレクションによって删除され、finalize方法が呼ばれたときに、警告が控制台に显示されるようになります。<br />
　警告は以下のような物です。<br />

<br />
<code class="bq">警告:&nbsp;anonymous@0x016DFA7C(9)[(function)&nbsp;finalize]:&nbsp;删除中の对象&nbsp;0x0167DD44[instance&nbsp;of&nbsp;class&nbsp;A]&nbsp;上でコードが执行されています。この对象の作成時の呼び出し履歴は以下の通りです:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;anonymous@0x016DFA7C(13)[(top&nbsp;level&nbsp;script)&nbsp;global]</code>
<br />

　このような状況を防ぐため、new で作成した对象は、使用し終わったら明示的に invalidate 演算子で無効化することを推奨します。<br />
　ただし、Array や Dictionary、Date のように finalize 方法がない、あるいは finalize 方法では特に問題を起こすような動作を起こさない类の对象については、明示的な無効化は必要ない場合があります。<br />
　上記の警告は、明示的な無効化が無いまま对象が删除されようとし、そのコンテキスト上でTJS2脚本が执行されようとした場合に显示されます。</dd>
<dt>呼び出し履歴の取得功能</dt>
<dd>　TJS2 の関数/方法呼び出し履歴を脚本から取得できるようになります。<br />
　これには <a target="main" class="jump" href="f_Scripts_getTraceString.html">Scripts.getTraceString</a> 方法を用います。<br />
　プログラムの途中に何か問題があり、その方法がどこから呼ばれたのか分からない場合に、この方法を使って、呼び出し履歴を控制台に出力したりができるようになります。<br />
</dd>
</dl></div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
