<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!-- generated by to_html.pl from ClickableMap.xml -->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>クリッカブルマップを使おう</title>
	<meta name="author" content="W.Dee" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<link href="browser.css" type="text/css" rel="stylesheet" title="吉里吉里相关参考标准样式" />
	<link href="mailto:dee@kikyou.info" rev="Made" />
	<link href="index.html" target="_top" rel="Start" title="主页" />
</head>
<body>
<h1><a id="id7" name="id7">クリッカブルマップとは</a>
</h1><div class="para"><div>
　クリッカブルマップは、直訳すれば「クリック」できる「地図」で、一つの画像の中にいくつかの「領域」を定義して、それらを鼠标などでクリックして選択できるようにする物です。<br />
<br />
　吉里吉里/KAGでは、本体の画像の他に「<a id="id8" name="id8" class="targanchor"><dfn>領域画像</dfn></a>」と「<a id="id9" name="id9" class="targanchor"><dfn>領域アクション定義文件</dfn></a>」という２つの文件を使ってこれを実現します。<br />
</div></div>
<h1><a id="id10" name="id10">領域画像とは</a>
</h1><div class="para"><div>
　領域画像は、本体の画像と同じサイズの 256 色の画像です。フルカラーの画像ではいけません。JPEG はこのような用途には向かないので、 PNG か BMP などの、256 色を使用できる画像形式を使います。<br />
<br />
　領域画像とは、本体の画像の各領域に対応して、各領域を任意の<a id="id11" name="id11" class="targanchor"><dfn>パレット索引</dfn></a>で塗りつぶした物です。たとえば、<br />
<br /><div class="descimg"><img width="365" height="379" alt="map1.png" src="map1.png" /><img width="365" height="379" alt="map1_p.png" src="map1_p.png" /><br />本体の画像(左)と領域画像(右)</div><br />　のようなものです。左が本体の画像で、この例では関東地方の地図です。右が、各都県に対応して各領域を塗りつぶした「領域画像」です。<br />
　領域画像は、各領域を任意の ( それぞれ異なる ) パレット索引で塗りつぶした物です。上の例で各領域に書いてある数字はそのパレット索引です ( 説明のために入れてあるので本来は必要ありません )。パレット索引 0 ( 図では海 ) で塗りつぶされた領域は領域としては使われない部分です。<br />
<br />
　图形編集ソフトなどには 256 色の画像で「パレット索引」を扱える物がありますが、そのようなソフトを用いて編集する必要があります ( パレット番号とか、カラー索引、索引カラー、色番号など名称は異なる場合があります )。このとき、重要なのはパレット索引 ( 色番号 ) であって、色ではありません。吉里吉里は領域画像を見るとき、色ではなくてそのパレット索引のみを見ます。色は、編集時に他の領域と見分けが付きやすいように、適当にばらけた色をつけておいてかまいません。<br />
<br />
　領域画像の文件名は、通常、本体の画像の文件名 ( 拡張子を除く ) に _p をつけた文件名です。たとえば、本体の画像の名前が map.png であれば、領域画像の文件名は ( PNGで保存する場合 ) map_p.png にします。<br />
</div></div>
<h1><a id="id12" name="id12">領域アクション定義文件とは</a>
</h1><div class="para"><div>
　領域アクション定義文件とは、クリッカブルマップの各領域の振る舞いを定義した文件です。<br />
　拡張子は .ma で、通常は本体の画像文件と同じ文件名にします。たとえば、本体の画像の名前が map.png であれば、領域アクション定義文件の文件名は map.ma にします。<br />
<br />
　領域アクション定義文件はテキスト文件ですのでテキスト编辑器で編集します。<br />
<br />
　領域アクション定義文件は、一行ごとに、「領域番号 ： アクション」を領域の数だけ書いた物です ( コロンは半角 )。<br />
　たとえば、上記の地図の例だと、<br />

<br />
<code class="bq">11:&nbsp;hint=&quot;埼玉&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m11&quot;;<br />
8:&nbsp;hint=&quot;群馬&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m8&quot;;<br />
7:&nbsp;hint=&quot;栃木&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m7&quot;;<br />
9:&nbsp;hint=&quot;茨城&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m9&quot;;<br />
10:&nbsp;hint=&quot;千葉&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m10&quot;;<br />
12:&nbsp;hint=&quot;東京&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m12&quot;;<br />
2:&nbsp;hint=&quot;神奈川&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m2&quot;;<br />
3:&nbsp;hint=&quot;山梨&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m3&quot;;<br />
1:&nbsp;hint=&quot;静岡&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m1&quot;;<br />
4:&nbsp;hint=&quot;長野&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m4&quot;;<br />
5:&nbsp;hint=&quot;新潟&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m5&quot;;<br />
6:&nbsp;hint=&quot;福島&quot;;&nbsp;storage=&quot;maptest2.ks&quot;;&nbsp;target=&quot;*m6&quot;;<br />
</code>
<br />

　のような記述になります。領域番号と、上の例の領域画像のパレット索引は一致しています。<br />
　「<a id="id13" name="id13" class="targanchor"><dfn>アクション</dfn></a>」 ( コロンより後の部分 ) は KAG の文法からは離れ、TJS の文法で書きますが、難しい物ではありません。<br />
　「名前=值;」の形式で必要なだけ書くというものです。セミコロンを忘れないようにしてください。<br />
<br />
　使用できる名前には以下の物があります。<br />
<dl>
<dt>storage, target, onenter, onleave, hint, exp, countpage </dt>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;　これらはすべて link タグと同様の機能を持っていますが、すべて、属性の值を &quot; &quot; ( ダブルクオーテーション ) で囲んで指定してください ( 上記の例のように )。&quot; &quot; で囲まないと错误になったり、正常に動作しなかったりします。</dd>
<dt>cursor</dt>
<dd>&nbsp;&nbsp;&nbsp;&nbsp;　領域の上に鼠标光标がある場合の鼠标光标形状を指定します。cursor タグでの指定に似ていますが、 cr で始まる鼠标光标常数を用いる場合は、&amp; をつけずにそのまま書きます ( たとえば  cursor = crSizeAll; )。鼠标光标の文件を指定する場合は &quot; &quot; ( ダブルクオーテーション ) で囲んで書きます ( たとえば  cursor = &quot;wagtail.ani&quot;; )。</dd></dl><br />
　領域アクション定義文件では、領域番号 0 は特別な指定をするために使用されます。現バージョンでは autodisable が使用可能です。たとえば、
<br />
<code class="bq">0&nbsp;:&nbsp;autodisable=false;</code>
<br />

　とすると、クリッカブルマップをクリックしても、クリッカブルマップが無効な ( クリッカブルマップとして操作できない ) 状態になりません。通常はこの指定を行わなくて OK です。<br />
　この指定を行わなかったり、領域アクション定義文件に領域番号 0 の指定がなかったりすると、クリッカブルマップをクリックしたとき、再び <a id="id14" name="id14" class="targanchor"><dfn>image</dfn></a> タグか <a id="id15" name="id15" class="targanchor"><dfn>mapaction</dfn></a> タグで領域アクション定義文件が読み込まれるまで、クリッカブルマップは無効な ( クリッカブルマップとして操作できない ) 状態になります。<br />
<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　アクションが何も定義されなければ、その領域は無視されます。たとえば、条件によって領域を使用可能にしたり不可能にしたりしたい場合は、TJS の if 文を使って、<br />
11: if(f.flag == 1) { hint=&quot;埼玉&quot;; storage=&quot;maptest2.ks&quot;; target=&quot;*m11&quot;; }<br />
　のように記述することができます。この場合は、f.flag が 1 の場合のみに、「hint=&quot;埼玉&quot;; storage=&quot;maptest2.ks&quot;; target=&quot;*m11&quot;;」というアクションを定義する、という意味になります。</div><br />
</div></div>

<h1><a id="id16" name="id16">クリッカブルマップを使ってみる</a>
</h1><div class="para"><div>
　クリッカブルマップを使ってみます。<br />
　上記の例を、本体の画像を map1.png、領域画像を map1_p.png、領域アクション定義文件を map1.ma とします。<br />
　image タグは、読み込もうとした本体文件名をもとにして、文件名に _p がついた文件と、拡張子が ma の文件を探して、それぞれ領域画像と領域アクション定義文件として読み込みます。<br />
　ですので、通常は、クリッカブルマップを使用可能にするためには image タグのみを使います。<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
&nbsp;&nbsp;&nbsp;&nbsp;　個別に領域画像や領域アクション定義文件を読み込みたい場合のために、それぞれ <a id="id17" name="id17" class="targanchor"><dfn>mapimage</dfn></a> タグと mapaction タグがあります。</div><br />
　たとえば、maptest.ks に以下の内容を書いたとします。<br />

<br />
<code class="bq">*start<br />
@image&nbsp;layer=0&nbsp;page=fore&nbsp;visible=true&nbsp;storage=map1<br />
@position&nbsp;left=400&nbsp;width=220<br />
@wt<br />
クリッカブルマップのテスト。<br />
@s<br />
</code>
<br />

　これだけで、クリッカブルマップが使用可能な状態で s タグで停止します。<br />
<br />
<br /><div class="descimg"><img width="650" height="528" alt="clickable.png" src="clickable.png" /><br />実行してみた画面</div><br /><br />
　クリッカブルマップがクリックされたときにジャンプするシナリオも記述しなければなりません。たとえば、maptest2.ks に以下のような内容を書きます。<br />

<br />
<code class="bq">*m11<br />
@cm<br />
そこは埼玉です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m8<br />
@cm<br />
そこは群馬です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m7<br />
@cm<br />
そこは栃木です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m9<br />
@cm<br />
そこは茨城です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m10<br />
@cm<br />
そこは千葉です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m12<br />
@cm<br />
そこは東京です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m2<br />
@cm<br />
そこは神奈川です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m3<br />
@cm<br />
そこは山梨です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m1<br />
@cm<br />
そこは静岡です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m4<br />
@cm<br />
そこは長野です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m5<br />
@cm<br />
そこは新潟です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
<br />
*m6<br />
@cm<br />
そこは福島です。[l]<br />
@jump&nbsp;storage=&quot;maptest.ks&quot;&nbsp;target=&quot;*start&quot;<br />
</code>
<br />

<br />
<br /><div class="note"><div class="notehead"><span class="noteheadspan">Note</span></div>
　(非表示、表裏に限らず) KAG 内にクリッカブルマップを使用した画像があると、键盘の光标キーで鼠标の移動をエミュレーションするモードに切り替わります。そのため edit タグのような键盘を用いるほかの機能が正常に使用できなくなります。<br />
　使い終わったら mapdisable タグで無効化するか、あるいはそのレイヤに別の画像を読み込んだり freeimage タグを使用したりしてクリッカブルマップを破棄すれば、通常の键盘の操作モードに戻ります。</div><br />
</div></div>
	<script type="text/javascript" charset="UTF-8" src="documentid.js" ></script>
	<script type="text/javascript" charset="UTF-8" src="postcontent.js" ></script>
</body>
</html>
